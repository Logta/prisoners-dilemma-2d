# 2D Prisoner's Dilemma シンプル版 - 仕様書

## 1. 概要

二次元グリッド上で囚人のジレンマゲームを実行し、エージェントの進化過程をブラウザの Canvas で可視化する Web アプリケーション。

## 2. 技術スタック

- **バックエンド**: Rust + WebAssembly（シミュレーション計算）
- **フロントエンド**: React Router v7 + shadcn/ui
- **可視化**: Canvas API
- **ビルドツール**: Vite
- **テスト**: Vitest
- **リンター**: Biome v2

## 3. コア機能

### 3.1 グリッドと表示

- **グリッドサイズ**: 100×100（固定）
- **エージェント表示**: 正方形（■）
- **色分け**: 直近 10 回の協力率に応じたグラデーション
  - 100%協力: 緑
  - 75%協力: 黄緑
  - 50%協力: 黄
  - 25%協力: オレンジ
  - 0%協力: 赤

### 3.2 エージェント

#### 遺伝子（2 つ）

1. **戦略タイプ**

   - AllCooperate: 常に協力
   - AllDefect: 常に裏切り
   - TitForTat: 相手の前回の行動を真似る
   - Pavlov: 前回勝利なら同じ行動、敗北なら逆の行動

2. **移動性向**: 0.0〜1.0 の実数値

#### 行動

- **対戦**: 隣接 8 マスのエージェントと対戦
- **移動**: 基本移動確率は移動性向の値
  - 直近の成績が悪い: 移動確率 = 移動性向 × 2.0
  - 直近の成績が良い: 移動確率 = 移動性向 × 0.5
  - 隣接する空きマスにランダム移動

### 3.3 囚人のジレンマ

#### 利得行列（固定）

|              | 相手が協力 | 相手が裏切り |
| ------------ | ---------- | ------------ |
| 自分が協力   | (3, 3)     | (0, 5)       |
| 自分が裏切り | (5, 0)     | (1, 1)       |

### 3.4 遺伝的アルゴリズム

#### 世代交代（100 ターンごと）

1. **選択**: ルーレット選択（スコアに比例した確率で親を選択）
2. **交叉**:
   - 戦略: 親のどちらかをランダムに継承
   - 移動性向: 両親の平均値
3. **突然変異**（5%の確率）:
   - 戦略: ランダムに別の戦略に変更
   - 移動性向: ±0.2 の範囲でランダムに変化

## 4. UI 構成

### メイン画面

- **Canvas 表示エリア**: 100×100 のグリッドを表示
- **コントロールパネル**:
  - 開始/停止ボタン
  - リセットボタン
  - 速度調整スライダー
- **統計情報パネル**:
  - 現在の世代数
  - 各戦略の個体数
  - 平均協力率

## 5. 実装の優先順位

1. Rust でシミュレーションエンジンを実装
2. WebAssembly にコンパイル
3. Remix で UI フレームワークを構築
4. Canvas でグリッドとエージェントをレンダリング Canvas でグリッドとエージェントをレンダリング
5. shadcn/ui でコントロールパネルを実装

## 6. 開発フロー（TDD）

- 各機能の実装前にテストを書く
- テストが通るたびに git commit
- 小さなステップで着実に進める
