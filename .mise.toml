# =============================================================================
# 2D Prisoner's Dilemma - mise configuration
# =============================================================================

[tools]
node = "24"
rust = "latest"
bun = "latest"

[env]
RUST_LOG = "debug"

# =============================================================================
# ğŸš€ DAILY COMMANDS - ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰
# =============================================================================

[tasks.dev]
description = "ğŸš€ é–‹ç™ºé–‹å§‹"
run = [
  "wasm-pack build --target web --out-dir pkg",
  "mkdir -p web/public/pkg && cp -r pkg/* web/public/pkg/",
  "cd web && bun run dev"
]

[tasks.test]
description = "ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ"
run = [
  "cargo test",
  "bun test"
]

[tasks.check]
description = "âœ… å“è³ªãƒã‚§ãƒƒã‚¯"
run = [
  "cargo clippy",
  "bun run biome:check"
]

[tasks.fmt]
description = "ğŸ¨ ã‚³ãƒ¼ãƒ‰æ•´å½¢"
run = [
  "cargo fmt",
  "bun run biome:fix"
]

# =============================================================================
# ğŸ”¨ BUILD COMMANDS - ãƒ“ãƒ«ãƒ‰é–¢é€£
# =============================================================================

[tasks.wasm]
description = "ğŸ¦€ WASMãƒ“ãƒ«ãƒ‰"
run = "wasm-pack build --target web --out-dir pkg"

[tasks.copy]
description = "ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼"
run = [
  "mkdir -p web/public/pkg",
  "cp -r pkg/* web/public/pkg/"
]
depends = ["wasm"]

[tasks.build]
description = "ğŸ—ï¸ æœ¬ç•ªãƒ“ãƒ«ãƒ‰"
run = [
  "mise run wasm",
  "mise run copy",
  "cd web && bun run build"
]

[tasks.preview]
description = "ğŸ‘€ æœ¬ç•ªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"
run = [
  "mise run build",
  "cd web && bun run preview"
]

# =============================================================================
# ğŸ“Š WATCH COMMANDS - ç›£è¦–ç³»
# =============================================================================

[tasks.watch]
description = "ğŸ‘€ ãƒ†ã‚¹ãƒˆç›£è¦–"
run = "cargo watch -x test"

[tasks.watch-wasm]
description = "ğŸ”„ WASMç›£è¦–"
run = "cargo watch -s 'mise run wasm && mise run copy'"

# =============================================================================
# ğŸ› ï¸ SETUP COMMANDS - ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
# =============================================================================

[tasks.setup]
description = "ğŸ› ï¸ åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
run = [
  "cargo install wasm-pack",
  "cargo install cargo-watch",
  "bun install"
]

[tasks.install]
description = "ğŸ“¦ ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
run = "bun install"

[tasks.clean]
description = "ğŸ§¹ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—"
run = [
  "rm -rf pkg/ web/public/pkg/ web/build/ target/",
  "echo 'ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†'"
]

# =============================================================================
# ğŸ“š UTILITY COMMANDS - ãã®ä»–
# =============================================================================

[tasks.docs]
description = "ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ"
run = "cargo doc --no-deps --open"

[tasks.size]
description = "ğŸ“Š ã‚µã‚¤ã‚ºç¢ºèª"
run = [
  "mise run build",
  "ls -lh pkg/*.wasm",
  "ls -lh web/build/assets/*.js"
]

[tasks.lint]
description = "ğŸ” è©³ç´°ãƒªãƒ³ãƒˆ"
run = [
  "cargo clippy -- -D warnings",
  "bun run biome:check"
]

# =============================================================================
# ğŸ¯ SHORTCUT COMMANDS - ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
# =============================================================================

[tasks.d]
description = "ğŸš€ é–‹ç™ºé–‹å§‹ (çŸ­ç¸®)"
run = "mise run dev"

[tasks.t]
description = "ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ (çŸ­ç¸®)"
run = "mise run test"

[tasks.c]
description = "âœ… å“è³ªãƒã‚§ãƒƒã‚¯ (çŸ­ç¸®)"
run = "mise run check"

[tasks.f]
description = "ğŸ¨ ã‚³ãƒ¼ãƒ‰æ•´å½¢ (çŸ­ç¸®)"
run = "mise run fmt"

[tasks.w]
description = "ğŸ‘€ ãƒ†ã‚¹ãƒˆç›£è¦– (çŸ­ç¸®)"
run = "mise run watch"

[tasks.b]
description = "ğŸ—ï¸ æœ¬ç•ªãƒ“ãƒ«ãƒ‰ (çŸ­ç¸®)"
run = "mise run build"