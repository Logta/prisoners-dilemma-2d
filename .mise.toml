# =============================================================================
# 2D Prisoner's Dilemma - mise configuration
# =============================================================================

[tools]
node = "24"
rust = "latest"
bun = "latest"

[env]
RUST_LOG = "debug"

# =============================================================================
# ğŸš€ DAILY COMMANDS - ã‚ˆãä½¿ã†ã‚³ãƒãƒ³ãƒ‰
# =============================================================================

[tasks.dev]
description = "ğŸš€ é–‹ç™ºé–‹å§‹"
run = [
  "cd wasm && wasm-pack build --target web --out-dir pkg",
  "mkdir -p web/src/assets/pkg && cp -r wasm/pkg/* web/src/assets/pkg/",
  "cd web && bun run dev"
]

[tasks.test]
description = "ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ"
run = [
  "cd wasm && cargo test",
  "cd web && bun test"
]

[tasks.check]
description = "âœ… å“è³ªãƒã‚§ãƒƒã‚¯"
run = [
  "cd wasm && cargo clippy",
  "cd web && bun run biome:check",
  "cd web && bun run type-check"
]

[tasks.fmt]
description = "ğŸ¨ ã‚³ãƒ¼ãƒ‰æ•´å½¢"
run = [
  "cd wasm && cargo fmt",
  "cd web && bun run biome:fix"
]

# =============================================================================
# ğŸ”¨ BUILD COMMANDS - ãƒ“ãƒ«ãƒ‰é–¢é€£
# =============================================================================

[tasks.wasm]
description = "ğŸ¦€ WASMãƒ“ãƒ«ãƒ‰"
run = "cd wasm && wasm-pack build --target web --out-dir pkg"

[tasks.copy]
description = "ğŸ“‚ ãƒ•ã‚¡ã‚¤ãƒ«ã‚³ãƒ”ãƒ¼"
run = [
  "mkdir -p web/src/assets/pkg",
  "cp -r wasm/pkg/* web/src/assets/pkg/"
]
depends = ["wasm"]

[tasks.build]
description = "ğŸ—ï¸ æœ¬ç•ªãƒ“ãƒ«ãƒ‰"
run = [
  "cd wasm && wasm-pack build --target web --out-dir pkg",
  "mkdir -p web/src/assets/pkg && cp -r wasm/pkg/* web/src/assets/pkg/",
  "cd web && bun run build"
]

[tasks.preview]
description = "ğŸ‘€ æœ¬ç•ªãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼"
run = [
  "cd wasm && wasm-pack build --target web --out-dir pkg",
  "mkdir -p web/src/assets/pkg && cp -r wasm/pkg/* web/src/assets/pkg/",
  "cd web && bun run build",
  "cd web && bun run preview"
]

# =============================================================================
# ğŸ“Š WATCH COMMANDS - ç›£è¦–ç³»
# =============================================================================

[tasks.watch]
description = "ğŸ‘€ ãƒ†ã‚¹ãƒˆç›£è¦–"
run = "cd wasm && cargo watch -x test"

[tasks.watch-wasm]
description = "ğŸ”„ WASMç›£è¦–"
run = "cd wasm && cargo watch -s 'wasm-pack build --target web --out-dir pkg && mkdir -p ../web/src/assets/pkg && cp -r pkg/* ../web/src/assets/pkg/'"

# =============================================================================
# ğŸ› ï¸ SETUP COMMANDS - ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
# =============================================================================

[tasks.setup]
description = "ğŸ› ï¸ åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—"
run = [
  "cargo install wasm-pack",
  "cargo install cargo-watch",
  "cd web && bun install"
]

[tasks.install]
description = "ğŸ“¦ ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«"
run = "cd web && bun install"

[tasks.clean]
description = "ğŸ§¹ ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—"
run = [
  "rm -rf pkg/ web/src/assets/pkg/ web/build/ target/",
  "echo 'ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—å®Œäº†'"
]

# =============================================================================
# ğŸ“š UTILITY COMMANDS - ãã®ä»–
# =============================================================================

[tasks.docs]
description = "ğŸ“š ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç”Ÿæˆ"
run = "cargo doc --no-deps --open"

[tasks.size]
description = "ğŸ“Š ã‚µã‚¤ã‚ºç¢ºèª"
run = [
  "cd wasm && wasm-pack build --target web --out-dir pkg",
  "mkdir -p web/src/assets/pkg && cp -r wasm/pkg/* web/src/assets/pkg/",
  "cd web && bun run build",
  "ls -lh wasm/pkg/*.wasm",
  "ls -lh web/build/assets/*.js"
]

[tasks.lint]
description = "ğŸ” è©³ç´°ãƒªãƒ³ãƒˆ"
run = [
  "cd wasm && cargo clippy -- -D warnings",
  "cd web && bun run biome:check",
  "cd web && bun run type-check"
]

[tasks.type-check]
description = "ğŸ·ï¸ å‹ãƒã‚§ãƒƒã‚¯"
run = "cd web && bun run type-check"

[tasks.ci]
description = "ğŸš¦ CI ãƒã‚§ãƒƒã‚¯ (ãƒ†ã‚¹ãƒˆ + å“è³ªãƒã‚§ãƒƒã‚¯)"
run = [
  "mise run test",
  "mise run check"
]

[tasks.full-check]
description = "ğŸ” å®Œå…¨ãƒã‚§ãƒƒã‚¯ (ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ + å“è³ªãƒã‚§ãƒƒã‚¯ + ãƒ†ã‚¹ãƒˆ)"
run = [
  "mise run fmt",
  "mise run check",
  "mise run test"
]

# =============================================================================
# ğŸ¯ SHORTCUT COMMANDS - ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
# =============================================================================

[tasks.d]
description = "ğŸš€ é–‹ç™ºé–‹å§‹ (çŸ­ç¸®)"
run = "mise run dev"

[tasks.t]
description = "ğŸ§ª ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ (çŸ­ç¸®)"
run = "mise run test"

[tasks.c]
description = "âœ… å“è³ªãƒã‚§ãƒƒã‚¯ (çŸ­ç¸®)"
run = "mise run check"

[tasks.f]
description = "ğŸ¨ ã‚³ãƒ¼ãƒ‰æ•´å½¢ (çŸ­ç¸®)"
run = "mise run fmt"

[tasks.tc]
description = "ğŸ·ï¸ å‹ãƒã‚§ãƒƒã‚¯ (çŸ­ç¸®)"
run = "mise run type-check"

[tasks.ci-short]
description = "ğŸš¦ CI ãƒã‚§ãƒƒã‚¯ (çŸ­ç¸®)"
run = "mise run ci"

[tasks.fc]
description = "ğŸ” å®Œå…¨ãƒã‚§ãƒƒã‚¯ (çŸ­ç¸®)"
run = "mise run full-check"

[tasks.w]
description = "ğŸ‘€ ãƒ†ã‚¹ãƒˆç›£è¦– (çŸ­ç¸®)"
run = "mise run watch"

[tasks.b]
description = "ğŸ—ï¸ æœ¬ç•ªãƒ“ãƒ«ãƒ‰ (çŸ­ç¸®)"
run = [
  "cd wasm && wasm-pack build --target web --out-dir pkg",
  "mkdir -p web/src/assets/pkg && cp -r wasm/pkg/* web/src/assets/pkg/",
  "cd web && bun run build"
]